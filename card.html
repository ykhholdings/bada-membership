<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BADA Membership Card</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .header h1 {
            color: white;
            font-size: 24px;
        }

        .settings-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }

        .settings-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        /* Î©§Î≤ÑÏã≠ Ïπ¥Îìú */
        .membership-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 2px solid #d4af37;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .membership-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212,175,55,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .card-header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }

        .card-tier {
            color: #d4af37;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .card-name {
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .qr-container {
            background: white;
            padding: 15px;
            border-radius: 12px;
            display: inline-block;
            margin-bottom: 15px;
        }

        .qr-code {
            width: 150px;
            height: 150px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
        }

        .card-phone {
            color: #d4af37;
            font-size: 16px;
            font-weight: 600;
        }

        /* Ìè¨Ïù∏Ìä∏ ÏÑπÏÖò */
        .points-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .points-label {
            color: #d4af37;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .points-value {
            color: white;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .points-aed {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .progress-bar {
            background: rgba(255,255,255,0.1);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #d4af37 0%, #f4e5b1 100%);
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-out;
        }

        .progress-text {
            color: #9ca3af;
            font-size: 12px;
        }

        /* Ïø†Ìè∞ ÏÑπÏÖò */
        .section-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coupons-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }

        .coupon-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #d4af37;
            transition: all 0.3s;
        }

        .coupon-card:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .coupon-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .coupon-title {
            color: #1a1a1a;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .coupon-badge {
            background: #10b981;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }

        .coupon-description {
            color: #4b5563;
            font-size: 14px;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .coupon-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .coupon-expiry {
            color: #9ca3af;
            font-size: 12px;
        }

        .use-btn {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .use-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .use-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        /* ÌôúÎèô ÏÑπÏÖò */
        .activity-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .activity-item {
            text-align: center;
        }

        .activity-label {
            color: #9ca3af;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .activity-value {
            color: white;
            font-size: 18px;
            font-weight: 700;
        }

        /* Ïï°ÏÖò Î≤ÑÌäºÎì§ */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .action-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 14px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        /* Îã§Ïùå Î¶¨ÏõåÎìú */
        .next-reward {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Î°úÎî© */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: white;
        }

        .spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid #d4af37;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ÏóêÎü¨ */
        .error-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            margin: 100px auto;
        }

        .error-container h2 {
            color: #dc2626;
            margin-bottom: 15px;
        }

        .error-container p {
            color: #4b5563;
            margin-bottom: 20px;
        }

        .error-btn {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        /* ÌôòÏòÅ Î∞∞ÎÑà (Ïã†Í∑ú Í∞ÄÏûÖÏûê) */
        .welcome-banner {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-banner h3 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .welcome-banner p {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Î°úÎî© ÏÉÅÌÉú -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading your membership...</p>
    </div>

    <!-- ÏóêÎü¨ ÏÉÅÌÉú -->
    <div id="error" class="error-container" style="display: none;">
        <h2>üòï Oops!</h2>
        <p id="errorMessage">Could not load your membership card.</p>
        <button class="error-btn" onclick="window.location.href='index.html'">
            Back to Registration
        </button>
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
    <div id="mainContent" class="container" style="display: none;">
        <div class="header">
            <h1>üçú BADA</h1>
            <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>
        </div>

        <!-- Ïã†Í∑ú Í∞ÄÏûÖ ÌôòÏòÅ Î∞∞ÎÑà -->
        <div id="welcomeBanner" class="welcome-banner" style="display: none;">
            <h3>üéâ Welcome to BADA!</h3>
            <p>You've earned 50 bonus points to get started</p>
        </div>

        <!-- Î©§Î≤ÑÏã≠ Ïπ¥Îìú -->
        <div class="membership-card">
            <div class="card-header">
                <div class="card-tier" id="memberTier">PREMIUM MEMBER</div>
                <div class="card-name" id="memberName">Loading...</div>
                <div class="qr-container">
                    <div class="qr-code" id="qrCode">
                        QR CODE
                    </div>
                </div>
                <div class="card-phone" id="memberPhone">+971 XXX XXXX</div>
            </div>
        </div>

        <!-- Ìè¨Ïù∏Ìä∏ ÏÑπÏÖò -->
        <div class="points-section">
            <div class="points-label">üíé Your Points</div>
            <div class="points-value" id="pointsValue">0</div>
            <div class="points-aed" id="pointsAED">= 0 AED discount</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progressText">
                0 more points ‚Üí Next tier!
            </div>
        </div>

        <!-- Ïø†Ìè∞ ÏÑπÏÖò -->
        <div class="section-title">üéüÔ∏è Active Coupons <span id="couponCount">(0)</span></div>
        <div class="coupons-container" id="couponsContainer">
            <!-- Ïø†Ìè∞Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê® -->
        </div>

        <!-- ÌôúÎèô ÏÑπÏÖò -->
        <div class="section-title">üìä Your Activity</div>
        <div class="activity-section">
            <div class="activity-grid">
                <div class="activity-item">
                    <div class="activity-label">Total Visits</div>
                    <div class="activity-value" id="totalVisits">0</div>
                </div>
                <div class="activity-item">
                    <div class="activity-label">Member Since</div>
                    <div class="activity-value" id="memberSince">-</div>
                </div>
                <div class="activity-item">
                    <div class="activity-label">Last Visit</div>
                    <div class="activity-value" id="lastVisit">-</div>
                </div>
                <div class="activity-item">
                    <div class="activity-label">Favorite</div>
                    <div class="activity-value" id="favoriteMenu">-</div>
                </div>
            </div>
        </div>

        <!-- Ïï°ÏÖò Î≤ÑÌäº -->
        <div class="action-buttons">
            <button class="action-btn" onclick="inviteFriend()">
                üë• Invite Friend
            </button>
            <button class="action-btn" onclick="addToWallet()">
                üí≥ Add to Wallet
            </button>
        </div>

        <!-- Îã§Ïùå Î¶¨ÏõåÎìú -->
        <div class="next-reward" id="nextReward">
            üéâ Next reward: Silver status at 5 visits or 1,000 AED
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
        // ============================================
        // ÏÑ§Ï†ï
        // ============================================
        const API_URL = 'https://script.google.com/macros/s/AKfycbwvWhJABsvtUxOHZ_yLmX-k27sJ4ZLLjCIVIWZlRRFMurzCHwyXjteS5q9GatFpEbyTfQ/exec';
        const STORAGE_KEY = 'bada_membership_phone';

        let customerData = null;

        // ============================================
        // ÎîîÎ≤ÑÍ∑∏ Î°úÍπÖ
        // ============================================
        //function debugLog(message, data) {
         //   console.log('üîç DEBUG:', message, data);
            
            // ÌôîÎ©¥ÏóêÎèÑ ÌëúÏãú (Í∞úÎ∞úÏö©)
        //    const debugDiv = document.getElementById('debugInfo');
       //     if (debugDiv) {
       //         debugDiv.innerHTML += `<div>${message}: ${JSON.stringify(data)}</div>`;
       //     }
        //}

        // ============================================
        // ÌéòÏù¥ÏßÄ Î°úÎìú
        // ============================================
        window.addEventListener('load', async () => {
            debugLog('Page loaded', new Date());
            
            // URL ÌååÎùºÎØ∏ÌÑ∞ Ï≤¥ÌÅ¨
            const urlParams = new URLSearchParams(window.location.search);
            const isNewMember = urlParams.get('new') === '1';
            debugLog('Is new member?', isNewMember);

            // LocalStorageÏóêÏÑú Ï†ÑÌôîÎ≤àÌò∏ Í∞ÄÏ†∏Ïò§Í∏∞
            const savedPhone = localStorage.getItem(STORAGE_KEY);
            debugLog('Saved phone from LocalStorage', savedPhone);

            if (!savedPhone) {
                debugLog('No phone found', 'Redirecting to index');
                showError('No membership found. Please register first.');
                return;
            }

            // Í≥†Í∞ù Ï†ïÎ≥¥ Î°úÎìú
            await loadCustomerData(savedPhone, isNewMember);
        });

        // ============================================
        // Í≥†Í∞ù Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        // ============================================
        async function loadCustomerData(phone, isNewMember = false) {
            debugLog('Loading customer data for', phone);
            
            try {
                debugLog('Making API call to', API_URL);
                
                const requestBody = {
                    action: 'findByPhone',
                    phone: phone
                };
                debugLog('Request body', requestBody);

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify(requestBody)
                });

                debugLog('Response status', response.status);
                
                const result = await response.json();
                debugLog('API response', result);

                if (result && result.customer_id) {
                    customerData = result;
                    debugLog('Customer data loaded', customerData);
                    displayMembershipCard(isNewMember);
                } else {
                    debugLog('Invalid response', result);
                    showError('Could not load your membership. API returned: ' + JSON.stringify(result));
                }

            } catch (error) {
                debugLog('Load error', error.toString());
                console.error('Full error:', error);
                showError('Connection error: ' + error.message);
            }
        }

        // ============================================
        // Î©§Î≤ÑÏã≠ Ïπ¥Îìú ÌëúÏãú
        // ============================================
        function displayMembershipCard(isNewMember) {
            debugLog('Displaying card', { isNewMember, customerData });
            
            // Î°úÎî© Ïà®Í∏∞Í∏∞
            document.getElementById('loading').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';

            // Ïã†Í∑ú Í∞ÄÏûÖÏûê ÌôòÏòÅ Î∞∞ÎÑà
            if (isNewMember) {
                document.getElementById('welcomeBanner').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('welcomeBanner').style.display = 'none';
                }, 5000);
            }

            // Í∏∞Î≥∏ Ï†ïÎ≥¥
            document.getElementById('memberTier').textContent = 
                (customerData.member_tier || 'Bronze').toUpperCase() + ' MEMBER';
            
            document.getElementById('memberName').textContent = 
                customerData.name || 'Valued Guest';
            
            document.getElementById('memberPhone').textContent = 
                maskPhone(customerData.phone_number);

            // QR ÏΩîÎìú ÏÉùÏÑ±
            generateQRCode(customerData.customer_id);

            // Ìè¨Ïù∏Ìä∏
            const points = customerData.available_points || 0;
            const pointsAED = Math.floor(points / 20);
            
            document.getElementById('pointsValue').textContent = points;
            document.getElementById('pointsAED').textContent = `= ${pointsAED} AED discount`;

            // ÏßÑÌñâÎ•† Í≥ÑÏÇ∞
            updateProgressBar(customerData);

            // ÌôúÎèô Ï†ïÎ≥¥
            document.getElementById('totalVisits').textContent = 
                customerData.total_visits || 0;
            
            document.getElementById('memberSince').textContent = 
                formatDate(customerData.created_at);
            
            document.getElementById('lastVisit').textContent = 
                customerData.last_visit_date ? formatDateRelative(customerData.last_visit_date) : 'Never';
            
            document.getElementById('favoriteMenu').textContent = 
                customerData.favorite_menu || '-';

            // Ïø†Ìè∞ Î°úÎìú
            loadCoupons();

            // Îã§Ïùå Î¶¨ÏõåÎìú
            updateNextReward(customerData);
            
            debugLog('Card display complete', 'Success');
        }

        // ============================================
        // QR ÏΩîÎìú ÏÉùÏÑ±
        // ============================================
        function generateQRCode(customerId) {
            const qrContainer = document.getElementById('qrCode');
            qrContainer.innerHTML = '';

            try {
                new QRCode(qrContainer, {
                    text: customerId,
                    width: 150,
                    height: 150,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
                debugLog('QR code generated', customerId);
            } catch (error) {
                debugLog('QR generation error', error);
                qrContainer.textContent = customerId;
            }
        }

        // ============================================
        // ÏßÑÌñâÎ•† Î∞î ÏóÖÎç∞Ïù¥Ìä∏
        // ============================================
        function updateProgressBar(customer) {
            const tier = customer.member_tier || 'Bronze';
            const visits = customer.total_visits || 0;
            const spent = customer.total_spent || 0;

            let nextTier, targetVisits, targetSpent, progress, remaining;

            if (tier === 'Bronze') {
                nextTier = 'Silver';
                targetVisits = 5;
                targetSpent = 1000;
                progress = Math.max(
                    (visits / targetVisits) * 100,
                    (spent / targetSpent) * 100
                );
                remaining = Math.max(0, targetVisits - visits);
            } else if (tier === 'Silver') {
                nextTier = 'Gold';
                targetVisits = 15;
                targetSpent = 3000;
                progress = Math.max(
                    (visits / targetVisits) * 100,
                    (spent / targetSpent) * 100
                );
                remaining = Math.max(0, targetVisits - visits);
            } else if (tier === 'Gold') {
                nextTier = 'Platinum';
                targetVisits = 30;
                targetSpent = 10000;
                progress = Math.max(
                    (visits / targetVisits) * 100,
                    (spent / targetSpent) * 100
                );
                remaining = Math.max(0, targetVisits - visits);
            } else {
                nextTier = 'MAX';
                progress = 100;
                remaining = 0;
            }

            document.getElementById('progressBar').style.width = Math.min(progress, 100) + '%';
            
            if (nextTier === 'MAX') {
                document.getElementById('progressText').textContent = 
                    'üèÜ You\'ve reached the highest tier!';
            } else {
                document.getElementById('progressText').textContent = 
                    `${remaining} more visits ‚Üí ${nextTier}!`;
            }
        }

        // ============================================
        // Îã§Ïùå Î¶¨ÏõåÎìú ÏóÖÎç∞Ïù¥Ìä∏
        // ============================================
        function updateNextReward(customer) {
            const tier = customer.member_tier || 'Bronze';
            const visits = customer.total_visits || 0;
            const spent = customer.total_spent || 0;

            let message = '';

            if (tier === 'Bronze') {
                const visitsNeeded = Math.max(0, 5 - visits);
                const spentNeeded = Math.max(0, 1000 - spent);
                message = `üéâ Next reward: Silver status at ${visitsNeeded} more visits or ${spentNeeded} AED`;
            } else if (tier === 'Silver') {
                const visitsNeeded = Math.max(0, 15 - visits);
                const spentNeeded = Math.max(0, 3000 - spent);
                message = `üéâ Next reward: Gold status at ${visitsNeeded} more visits or ${spentNeeded} AED`;
            } else if (tier === 'Gold') {
                const visitsNeeded = Math.max(0, 30 - visits);
                const spentNeeded = Math.max(0, 10000 - spent);
                message = `üéâ Next reward: Platinum status at ${visitsNeeded} more visits or ${spentNeeded} AED`;
            } else {
                message = 'üèÜ You are at the highest tier! Thank you for your loyalty!';
            }

            document.getElementById('nextReward').textContent = message;
        }

        // ============================================
        // Ïø†Ìè∞ Î°úÎìú
        // ============================================
        function loadCoupons() {
            const container = document.getElementById('couponsContainer');
            
            const sampleCoupons = [
                {
                    title: 'üéÅ Welcome Bonus',
                    description: 'Free appetizer with any main dish',
                    expiry: 'Valid: 7 days',
                    badge: 'NEW'
                }
            ];

            if (sampleCoupons.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 20px;">No active coupons yet</p>';
                document.getElementById('couponCount').textContent = '(0)';
                return;
            }

            document.getElementById('couponCount').textContent = `(${sampleCoupons.length})`;

            container.innerHTML = sampleCoupons.map((coupon, index) => `
                <div class="coupon-card">
                    <div class="coupon-header">
                        <div>
                            <div class="coupon-title">${coupon.title}</div>
                            <div class="coupon-description">${coupon.description}</div>
                        </div>
                        <div class="coupon-badge">${coupon.badge}</div>
                    </div>
                    <div class="coupon-footer">
                        <div class="coupon-expiry">${coupon.expiry}</div>
                        <button class="use-btn" onclick="useCoupon(${index})">Use Coupon ‚Üí</button>
                    </div>
                </div>
            `).join('');
        }

        // ============================================
        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò
        // ============================================

        function maskPhone(phone) {
            if (!phone) return '+971 XXX XXXX';
            const phoneStr = String(phone); // Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
            const last4 = phoneStr.slice(-4);
            return '+971 XXX ' + last4;
        }
               

        function formatDate(dateString) {
            if (!dateString || dateString === '') return '-';
            try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '-';
            const month = date.toLocaleString('en', { month: 'short' });
            const year = date.getFullYear();
            return month + ' ' + year;
            } catch (e) {
                return '-';
            }
        }

        function formatDateRelative(dateString) {
            if (!dateString) return 'Never';
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            return `${Math.floor(diffDays / 30)} months ago`;
        }

        function showError(message) {
            debugLog('Showing error', message);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('errorMessage').textContent = message;
        }

        // ============================================
        // Ïï°ÏÖò Ìï®ÏàòÎì§
        // ============================================

        function useCoupon(index) {
            alert('Coupon usage feature coming soon!\n\nShow this screen to staff to redeem your coupon.');
        }

        function inviteFriend() {
            const referralLink = `https://ykhholdings.github.io/bada-membership/?ref=${customerData.customer_id}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Join BADA Restaurant',
                    text: 'Get 10% OFF your first meal at BADA!',
                    url: referralLink
                });
            } else {
                alert('Referral link:\n\n' + referralLink + '\n\nShare this with your friends!');
            }
        }

        function addToWallet() {
            alert('Add to Wallet feature coming soon!\n\nFor now, you can bookmark this page or add to home screen.');
        }

        function openSettings() {
            if (confirm('Sign out and return to registration?')) {
                localStorage.removeItem(STORAGE_KEY);
                window.location.href = 'index.html';
            }
        }
    </script>
    
    <!-- ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ (ÌôîÎ©¥ ÌïòÎã®, Í∞úÎ∞úÏö©) -->
    <div id="debugInfo" style="position: fixed; bottom: 0; left: 0; right: 0; background: #000; color: #0f0; font-size: 10px; padding: 10px; max-height: 150px; overflow-y: auto; font-family: monospace; display: none;">
    </div>
    
    <!-- F12Î•º ÎàåÎü¨ÏÑú Console ÌôïÏù∏Ïö© ÏïàÎÇ¥ -->
    <script>
        // Ctrl+Shift+DÎ°ú ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ ÌÜ†Í∏Ä
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                const debugDiv = document.getElementById('debugInfo');
                debugDiv.style.display = debugDiv.style.display === 'none' ? 'block' : 'none';
            }
        });
    </script>
